<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="Description" content="IRCTC Next Generation eTicketing System">
    <meta name="theme-color" content="#213d77">
    <title>IRCTC Next Generation eTicketing System</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link async="async" rel="stylesheet" as="style"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
        integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link async="async" crossorigin="" rel="stylesheet" as="style"
        href="https://cdn.jsdelivr.net/npm/primeng@9.0.5/resources/primeng.min.css">
    <link async="async" crossorigin="" rel="stylesheet" as="style"
        href="https://cdn.jsdelivr.net/npm/primeng@9.0.5/resources/themes/nova-light/theme.css">
    <link async="async" crossorigin="" rel="stylesheet" as="style"
        href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="manifest" href="manifest.json">

    <meta name="theme-color" content="#1976d2">

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
    </style>
</head>


<body>
    <script src="../static/static/js/bootstrap.min.js"></script>
    <script src="../static/static/js/propper.js"></script>


    <div class="container">
        <div class="row">
            <div class="col-md-12 mt-4 text-dark">
                {% include 'header_train.html' %}
            </div>
        </div>
    </div>


    <div class="container ">
        <div class="row">
            <div class="col-md-12  bg-light text-dark">
                <div class="col-md-12 clearfix margin-top"></div>
                <!--                trainContext: {{ trainContext }}-->
                <!--                seletedClass: {{seletedClass}}-->
                <!--                arrivalTime:{{arrivalTime}}-->
                <!--                sourceStn:{{sourceStn}}-->
                <!--                destStn:{{destStn}}-->
                <!--                jDate:{{jDate}}-->
                <app-root ng-version="9.1.13">
                    <app-home>
                        <div class="col-xs-12 clearfix margin-top"></div>
                        <div role="contentinfo" id="divMain" class="header-top"
                            style="min-height: calc(100vh - 400px);">
                            <div style="background: #ffffff;">
                                <app-passenger-input _nghost-crj-c117="">
                                    <div id="psgn-form" class="col-xs-12" style="padding: 0px;">
                                        <form action="/confirm_ticket" class="form-inline" id="booking_form"
                                            method="post">

                                            {% csrf_token %}


                                            <div class="body_div">
                                                <div class="col-lg-9 col-md-9 col-sm-12 remove-padding">
                                                    <div></div>
                                                    <div class="form-group col-xs-12 border-all zeroPadding">
                                                        <app-train-header _nghost-crj-c77="">
                                                            <div class="no-pad col-xs-12 ">
                                                                <div class="dull-back train-Header"><span
                                                                        class="train-type train-type-O"></span>
                                                                    <div class="pull-left train-heading mt-3">
                                                                        <strong>
                                                                            {{trainContext|upper}}</strong>
                                                                    </div>

                                                                    <div class="hidden-lg hidden-md hiddem-sm col-xs-12 no-pad"
                                                                        style="margin-top: 7px; font-size: initial;">
                                                                        <strong></strong>
                                                                    </div>
                                                                </div>
                                                                <div class="col-xs-12 clearfix"
                                                                    style="margin-top: 0px;"></div>
                                                                <div class="train-Header tbis-height">
                                                                    <div style="padding: 0px;"
                                                                        class="col-sm-9 col-xs-12">
                                                                        <div class="col-xs-5 hidden-xs"><span
                                                                                class="pull-left"><strong><span>{{arrivalTime}}</span>
                                                                                    |
                                                                                    {{sourceStn|upper}}</strong><br><span
                                                                                    class="col-xs-12 text-center">{{jDate}}</span></span>
                                                                        </div>
                                                                        <div class="col-xs-7 hidden-xs">
                                                                            <span
                                                                                class="col-xs-3 pull-left line-hr "><span>07:18</span></span><span
                                                                                class="pull-right"><strong><span>00:38</span>
                                                                                    | {{destStn|upper}}
                                                                                </strong><br><span
                                                                                    class="col-xs-12 text-center"></span></span>
                                                                        </div>
                                                                        <div class="col-xs-12 clearfix"></div>
                                                                        <div class="hidden-lg hidden-md hidden-sm">
                                                                            <div class="time col-xs-4">17:20
                                                                            </div>
                                                                            <div class="col-xs-4 line-hr ">
                                                                                <span>07:18</span>
                                                                            </div>
                                                                            <div class="col-xs-4">
                                                                                <span
                                                                                    class="pull-right time">00:38</span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-xs-12 clearfix"></div>
                                                                        <div
                                                                            class="col-xs-12 hidden-lg hidden-md hidden-sm">
                                                                            <div class="pull-left">PUNE JN
                                                                            </div>
                                                                            <div class="pull-right">PACHORA JN
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-xs-12 clearfix"></div>
                                                                        <div
                                                                            class="col-xs-12 hidden-lg hidden-md hidden-sm">
                                                                            <div class="pull-left">Tue, 20 Feb
                                                                            </div>
                                                                            <div class="pull-right">Wed, 21
                                                                                Feb
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div class="form-group col-xs-12 clearfix ">
                                                                </div>

                                                                <div
                                                                    class="col-sm-9 col-xs-12 remove-padding text-center">

                                                                    <span class="dull-back" style="padding: 5px;">
                                                                        <strong>
                                                                            <span style="padding: 2px 0px;">
                                                                                {% if 'seletedClass' == 'SL' %}
                                                                                Sleeper (SL) |
                                                                                {% else %}
                                                                                AC 3 Tier (3A) |
                                                                                {% endif %}
                                                                            </span>

                                                                            <span style="padding: 2px 0px;">
                                                                                General</span>
                                                                        </strong>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <div class="col-xs-12 clearfix " style="padding-top: 10px;">
                                                            </div>
                                                        </app-train-header>
                                                    </div>
                                                    <div class="col-xs-12 margin"></div>
                                                    <div class="form-group col-xs-12 border-all" style="padding: 0px;">
                                                        <div class="no-pad col-xs-12"></div>
                                                        <div class=" ui-panel ui-widget ui-widget-content ui-corner-all"
                                                            id="ui-panel-12" style="margin-bottom: 10px;">
                                                            <div class=" ui-panel-titlebar ui-widget-header ui-helper-clearfix ui-corner-all "
                                                                id="ui-panel-12-titlebar">
                                                                <p-header class="col-xs-11 " style="padding: 0px 0px;">
                                                                    <div class="ui-helper-clearfix">
                                                                        <span class="ui-panel-title p-heading">Passenger
                                                                            Details</span>
                                                                    </div>
                                                                </p-header>

                                                            </div>
                                                            <div role="region"
                                                                class="ui-panel-content-wrapper  ng-trigger ng-trigger-panelContent"
                                                                id="ui-panel-12-content" aria-hidden="false"
                                                                aria-labelledby="ui-panel-12-titlebar"
                                                                style="opacity: 1;">
                                                                <div class="ui-panel-content ui-widget-content ">

                                                                    <div>

                                                                        <app-passenger _nghost-crj-c111="">
                                                                            <div class="row" style="width: 50%; padding: 8px;
                                                                                text-align: center;">

                                                                                <table id="booking_table"
                                                                                    class="padding: 9px;">
                                                                                    <thead>
                                                                                        <tr>
                                                                                            <th>Passenger Name</th>
                                                                                            <th>Age</th>
                                                                                            <th>Gender</th>
                                                                                            <th></th>
                                                                                        </tr>
                                                                                    </thead>
                                                                                    <tbody class="mt-3">
                                                                                        <tr style="padding: 9px;">
                                                                                            <td><input
                                                                                                    class="form-control ui-inputtext ui-widget ui-state-default ui-corner-all  "
                                                                                                    type="text"
                                                                                                    name="pName"
                                                                                                    placeholder="Passenger Name"
                                                                                                    size="24"
                                                                                                    maxlength="16">
                                                                                            </td>
                                                                                            <td><input maxlength="3"
                                                                                                    size="3"
                                                                                                    type="number"
                                                                                                    name="age" min="1"
                                                                                                    class="form-control  ng-invalid"
                                                                                                    placeholder="Age"
                                                                                                    max="125"></td>
                                                                                            <td><select name="gender"
                                                                                                    class="form-control  ng-invalid ">
                                                                                                    <option size="7"
                                                                                                        value="">
                                                                                                        Gender
                                                                                                    </option>
                                                                                                    <option size="7"
                                                                                                        value="M">
                                                                                                        Male
                                                                                                    </option>
                                                                                                    <option size="7"
                                                                                                        value="F">
                                                                                                        Female
                                                                                                    </option>
                                                                                                </select></td>
                                                                                            <td><a onclick="addRow()"
                                                                                                    class="fa bi-plus-lg fa-lg btn-add"
                                                                                                    style="float: right; margin: 1px 1px; color: #a7a7a7;"></a>
                                                                                            </td>
                                                                                            <td>
                                                                                                <a onclick="removeRow(this)"
                                                                                                    class="fa fa-remove fa-lg  btn-remove"
                                                                                                    style="float: right; margin: 0px 0px; color: #a7a7a7;"></a>
                                                                                            </td>
                                                                                        </tr>
                                                                                    </tbody>
                                                                                </table>
                                                                                <input type="hidden" id="payment"
                                                                                    name="payment" value="">

                                                                                <input type="hidden" id="jsonData"
                                                                                    name="jsonData" value="">

                                                                                <script>
                                                                                    function addRow() {
                                                                                        var table = document.getElementById("booking_table").getElementsByTagName('tbody')[0];
                                                                                        var newRow = table.insertRow(table.rows.length);
                                                                                        var cells = [];
                                                                                        cells[0] = newRow.insertCell(0);
                                                                                        var input = document.createElement('input');
                                                                                        input.type = 'text';
                                                                                        input.name = "pName"
                                                                                        input.className = "ui-inputtext ui-widget ui-state-default ui-corner-all  "
                                                                                        input.placeholder = "Passenger Name"
                                                                                        input.size = "24"
                                                                                        input.maxlength = "16"
                                                                                        cells[0].appendChild(input);

                                                                                        cells[1] = newRow.insertCell(1);
                                                                                        var input2 = document.createElement('input');
                                                                                        input2.type = 'number';
                                                                                        input2.name = "age"
                                                                                        input2.className = "form-control  ng-invalid"
                                                                                        input2.placeholder = "Age"
                                                                                        input2.size = "3"
                                                                                        input2.maxlength = "3"
                                                                                        input2.min = 1
                                                                                        input2.max = 125
                                                                                        cells[1].appendChild(input2);



                                                                                        cells[2] = newRow.insertCell(2);
                                                                                        var select = document.createElement('select');
                                                                                        select.name = "gender"
                                                                                        select.className = "form-control  ng-invalid "
                                                                                        var option1 = document.createElement('option');
                                                                                        option1.value = '';
                                                                                        option1.size = "7"
                                                                                        option1.textContent = 'Gender';
                                                                                        var option2 = document.createElement('option');
                                                                                        option2.value = 'M';
                                                                                        option2.size = "7"
                                                                                        option2.textContent = 'Male';
                                                                                        var option3 = document.createElement('option');
                                                                                        option3.value = 'F';
                                                                                        option3.size = "7"
                                                                                        option3.textContent = 'Female';
                                                                                        select.appendChild(option1);
                                                                                        select.appendChild(option2);
                                                                                        select.appendChild(option3);
                                                                                        cells[2].appendChild(select);

                                                                                        cells[3] = newRow.insertCell(3);
                                                                                        var aTag = document.createElement('a');
                                                                                        aTag.className = 'fa bi-plus-lg fa-lg btn-add';
                                                                                        aTag.style = 'float: right; margin: 1px 1px; color: #a7a7a7;';
                                                                                        aTag.onclick = addRow;
                                                                                        cells[3].appendChild(aTag);

                                                                                        cells[4] = newRow.insertCell(4);
                                                                                        var aTag2 = document.createElement('a');
                                                                                        aTag2.className = 'fa fa-remove fa-lg  btn-remove';
                                                                                        aTag2.style = 'float: right; margin: 1px 1px; color: #a7a7a7;';
                                                                                        aTag2.onclick = removeRow;
                                                                                        cells[4].appendChild(aTag2);

                                                                                    }

                                                                                    function removeRow(anchor) {
                                                                                        var row = anchor.parentNode.parentNode;
                                                                                        row.parentNode.removeChild(row);
                                                                                    }


                                                                                    function convertToLabels() {
                                                                                        savePassengerDetails();

                                                                                        var inputs = document.querySelectorAll('input[type="text"]');
                                                                                        inputs.forEach(function (input) {
                                                                                            var label = document.createElement("label");
                                                                                            label.textContent = input.value;
                                                                                            input.parentNode.replaceChild(label, input);
                                                                                        });

                                                                                        var inputs = document.querySelectorAll('input[type="number"]');
                                                                                        inputs.forEach(function (input) {
                                                                                            var label = document.createElement("label");
                                                                                            label.textContent = input.value;
                                                                                            input.parentNode.replaceChild(label, input);
                                                                                        });

                                                                                        var selects = document.querySelectorAll('select');
                                                                                        selects.forEach(function (select) {
                                                                                            var label = document.createElement("label");
                                                                                            var selectedIndex = select.selectedIndex;
                                                                                            label.textContent = select.options[selectedIndex].text;
                                                                                            select.parentNode.replaceChild(label, select);
                                                                                        });

                                                                                        document.getElementById('continue_btn').style.display = 'none';
                                                                                        document.getElementById('confirm_btn').style.display = 'inline-block';

                                                                                        <!-- update total fare-->
                                                                                        var table = document.getElementById("booking_table").getElementsByTagName('tbody')[0];
                                                                                        var ticketFare = parseInt("{{tFare}}") * parseInt(table.rows.length)
                                                                                        var totalFareTag = document.getElementById('totalFare')
                                                                                        totalFareTag.innerHTML = "₹" + ticketFare.toString()
                                                                                        totalFareTag.style.display = 'inline-block';


                                                                                        console.log("setting total fare")
                                                                                        var totalHidden = document.getElementById('payment')
                                                                                        totalHidden.value = ticketFare.toString()
                                                                                        console.log("totalfare ", ticketFare.toString())


                                                                                    }

                                                                                    function savePassengerDetails() {

                                                                                        var data = {};
                                                                                        data['tName'] = "{{trainContext}}"
                                                                                        data['jDate'] = "{{jDate}}"
                                                                                        data['sourceStn'] = "{{sourceStn}}"
                                                                                        data['destStn'] = "{{destStn}}"
                                                                                        data['sClass'] = "{{seletedClass}}"
                                                                                        data['arrTime'] = "{{arrivalTime}}"
                                                                                        data['tStatus'] = "{{tStatus}}"
                                                                                        data['tCount'] = "{{tCount}}"

                                                                                        //read all tr from booking_table -> tbody
                                                                                        var tableRows = document.querySelectorAll("#booking_table tbody tr");
                                                                                        var rowData = [];

                                                                                        // Iterate over each table row
                                                                                        tableRows.forEach(function (row) {
                                                                                            var inputs = row.querySelectorAll("input, number, select");
                                                                                            var rowDataItem = {};

                                                                                            // Iterate over each input/number/select element in the row
                                                                                            inputs.forEach(function (input) {
                                                                                                // Get the input's name and value
                                                                                                var inputName = input.getAttribute("name");
                                                                                                var inputValue = input.value;

                                                                                                // Add the input name and value to the row data
                                                                                                rowDataItem[inputName] = inputValue;
                                                                                            });

                                                                                            // Add the row data to the overall table data
                                                                                            rowData.push(rowDataItem);
                                                                                        });
                                                                                        data['passDetails'] = rowData
                                                                                        var jsonData = JSON.stringify(data);

                                                                                        document.getElementById('jsonData').value = jsonData;
                                                                                    }


                                                                                </script>
                                                                            </div>
                                                                        </app-passenger>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <div class="col-xs-12 margin"></div>

                                                </div>
                                                <div class="col-lg-3 col-md-3 col-sm-12 hidden-xs">
                                                    <app-fare-summary>
                                                        <div id="fare-summary" class="col-xs-12 border-all"
                                                            style="padding: 9px;">
                                                            <div>
                                                                <p-panel expandicon="fa fa-angle-down"
                                                                    collapseicon="fa fa-angle-up">
                                                                    <div class="ui-panel ui-widget ui-widget-content ui-corner-all"
                                                                        id="ui-panel-17">
                                                                        <div class="ui-panel-titlebar ui-widget-header ui-helper-clearfix ui-corner-all "
                                                                            id="ui-panel-17-titlebar">
                                                                            <p-header class="col-xs-11 "
                                                                                style="padding: 0px 0px;">
                                                                                <div class="ui-helper-clearfix"><span
                                                                                        class="ui-panel-title p-heading">
                                                                                        Fare
                                                                                        Summary </span>
                                                                                </div>
                                                                            </p-header>
                                                                        </div>
                                                                        <div role="region"
                                                                            class="ui-panel-content-wrapper  ng-trigger ng-trigger-panelContent"
                                                                            id="ui-panel-17-content" aria-hidden="false"
                                                                            aria-labelledby="ui-panel-17-titlebar"
                                                                            style="opacity: 1;">
                                                                            <div
                                                                                class="ui-panel-content ui-widget-content ">
                                                                                <div class="col-xs-12 line-def top-header"
                                                                                    style="position: relative;">
                                                                                    <span class="pull-left">Ticket
                                                                                        Fare</span><span
                                                                                        class="pull-right">₹
                                                                                        {{tFare}}</span>
                                                                                </div>
                                                                                <div class="col-xs-12 line-def top-header"
                                                                                    style="position: relative">
                                                                                    <span class="pull-left">Total
                                                                                        Fare</span><span id="totalFare"
                                                                                        class="pull-right"
                                                                                        style="display: none;">₹{{tFare}}
                                                                                    </span>
                                                                                </div>

                                                                                <div class="clearfix ">
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </p-panel>
                                                            </div>

                                                        </div>
                                                    </app-fare-summary>
                                                    <div class="col-xs-12 hidden-xs" style="margin: 20px auto;">
                                                        <div>
                                                            <button type="button" class="btn btn-info">Back</button>
                                                            <button type="button" id="continue_btn" class="btn btn-info"
                                                                onclick="convertToLabels()">Continue
                                                            </button>
                                                            <button type="submit" id="confirm_btn"
                                                                class="btn btn-warning" style="display:none;">Confirm
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>

                                    </div>
                                </app-passenger-input>
                            </div>
                        </div>
                    </app-home>
                </app-root>
            </div>
        </div>
    </div>

</body>

</html>